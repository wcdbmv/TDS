# Отчёт
Лабораторная работа 1 по предмету «Типы и структуры данных».<br>
__Керимов Ахмед__, ИУ7-34Б, Вариант 9.

## Техническое задание
__Задача:__ смоделировать операцию умножения целого числа длиной до 30
десятичных цифр на действительное число в форме ±m.n Е ±K, где суммарная длина
мантиссы (m+n) — до 30 значащих цифр, а величина порядка K — до 5 цифр.
Результат выдать в форме ±0.m1 Е ±K1, где m1 — до 30 значащих цифр, а K1 — до 5
цифр.

__Входные данные:__ числа в формате [+-]?\d+(.\d+)?([eE][+-]?\d+)?, первое —
целое, второе — действительное. В нормальном виде размер мантиссы до 30 значащих
цифр, показатель степени до 5 цифр.

__Выходные данные:__ число в формате ±0.m1 Е ±K1, где m1 — до 30 значащих цифр,
а K1 — до 5 цифр, или соответствующее сообщение об ошибке.

## Аварийные ситуации
1. Неправильный вызов программы. Выводится подсказка к использованию.
(`WRONG_USAGE_ERROR`)
2. Пустой ввод. Здесь и далее выводится сообщение об ошибке.
(`EMPTY_STRING_ERROR`)
3. Неправильный ввод. Невозможность преобразовать ввод в действительное число.
(`INVALID_STRING_ERROR`)
4. Переполнение буфера ввода. Введено больше 512 символов.
(`BUF_OVERFLOW_ERROR`)
5. Переполнение мантиссы. Введено больше 30 значащих цифр.
(`MANTISSA_OVERFLOW_ERROR`)
6. Переполнение степени. Введённый показатель степени по модулю больше 99999
(`EXPONENT_OVERFLOW_ERROR`)
7. Нецелое число. Первое введённое число по условию должно быть целым.
(`NOT_INT_ERROR`)
8. Переполнение умножения. Показатель степени произведения двух введённых чисел
не в допустимом диапазоне. (`MULTIPLY_OVERFLOW_ERROR`)

## Используемые структуры
__BigFloat__ — длинное действительное число с `MANTISSA_SIZE` (по умолчанию —
30) цифрами. Число хранится в нормализованном виде (П: 012.030e-56 = 1.203e-55).
```c
typedef struct
{
	int exponent;
	uint8_t mantissa[MANTISSA_SIZE]; // хранится в обратном порядке
	uint8_t length; // длина мантиссы
	bool sign; // true если отрицательное
} BigFloat;
```

## Алгоритмы
### Преобразование строки в длинное действительное число
Сначала строка проверяется на пустоту (`EMPTY_STRING_ERROR`), затем определяется
знак числа, пропускаются незначащие нули, остальные цифры до запятой
записываются в буфер (возможна `BUF_OVERFLOW_ERROR`), увеличивая показатель
степени. Далее пропускаются, если для этого есть причины (до этого были только
нули), незначащие нули после запятой, при этом показатель степени уменьшается
(0000.00002 = 2e-4), остальные цифры записываются дальше в буфер (возможна,
опять же, `BUF_OVERFLOW_ERROR`). Если в буфер ничего не считалось и нулей не
было, то `INVALID_STRING_ERROR` (это либо строка из недопустимых символов, либо
одна лишь запятая [+.e12]). Затем обрезаются незначащие нули сзади (1.02000 =
1.02), если после этого длина буфера нулевая, то число — ноль. Если имеется
экспонента, то определяется её знак, пропускаются нули и значащие цифры
записываются в буфер (случай, если показатель степени 0 или отсутствует
(1.23e+ — `INVALID_STRING_ERROR`), учитывается). Если после всего считывания
конец строки не обнаружен, возвращается `INVALID_STRING_ERROR`. Если ноль —
устанавливается ноль и возвращается `SUCCESS`. Проверяется длина введённой
мантиссы и экспоненты (`MANTISSA_OVERFLOW_ERROR` или `EXPONENT_OVERFLOW_ERROR`).
Если всё в норме, то, что считали, записывается в экземпляр структуры `BigFloat`
и возвращается `SUCCESS`.

Сложность алгоритма линейная, потому как введённое проходится в прямом
направлении один раз, и один раз, возможно, в обратном при удалении задних
(trailing) нулей.

Отделить проверку строки от преобразования её в длинное вещественное не
представляется мне разумным, так как в таком случае при преобразовании придётся
повторить большинство из тех операций, что были в проверке. Эти операции
неразрывно между собой связаны как логически, так и функционально.

### Умнножение
Если среди операндов есть ноль, результат — ноль (возвр. `SUCCESS`).
Производится обычное школьное умножение в столбик в буфер размера двойной
мантиссы. Знак произведения есть xor знаков множителей. Показатель степени
произведения есть сумма показателей степени множителей плюс, возможно, единица
при переполнения последнего разряда. Если мантисса больше `MANTISSA_SIZE`, то
производится округление символа, следующим за последним. При этом если в конце
есть девятки, они становятся нулями и отбрасываются.

## Тесты
1. Работает в простых ситуациях
```
Введите целое число               |
>>> 2                             |
Введите действительное число      |
>>> 2                             |
Произведение этих чисел:
+0.4e1
```
2. Работает с отрицательными числами
```
Введите целое число               |
>>> 2                             |
Введите действительное число      |
>>> -0.2e+1                       |
Произведение этих чисел:
-0.4e1
```
```
Введите целое число               |
>>> -02.000e+0                    |
Введите действительное число      |
>>> -2.0e-000                     |
Произведение этих чисел:
+0.4e1
```
3. Работает с нулем
```
Введите целое число               |
>>> +00.000E-0000                 |
Введите действительное число      |
>>> +123.456E+789                 |
Произведение этих чисел:
0
```
4. Правильно округляет
```
Введите целое число               |
>>> 30003000300030003000300030003 |
Введите действительное число      |
>>> 3333                          |
Произведение этих чисел:
+0.1e+32
```
5. Обнаруживает неправильный ввод
```
Введите целое число               |
>>> hehe                          |
Ошибка: Неправильный ввод
```
```
Введите целое число               |
>>> 12-3                          |
Ошибка: Неправильный ввод
```
```
Введите целое число               |
>>> e+123                         |
Ошибка: Неправильный ввод
```
```
Введите целое число               |
>>> 1.0e+                         |
Ошибка: Неправильный ввод
```
```
Введите целое число               |
>>> .                             |
Ошибка: Неправильный ввод
```
```
Введите целое число               |
>>> -.e+10                        |
Ошибка: Неправильный ввод
```
```
Введите целое число               |
>>> -001.200e-05f                 |
Ошибка: Неправильный ввод
```
```
Введите целое число               |
>>> 0.1                           |
Ошибка: Введено не целое число
```
```
Введите целое число               |
>>> 9999999999999999999999999999999
Ошибка: Мантисса введённого числа слишком большая
```
```
Введите целое число               |
>>> 1e+999999                     |
Ошибка: Показатель степени введённого числа больше допустимого по абсолютному значению
```
6. Правильно работает на граничных значениях
```
Введите целое число               |
>>> 0.1e99999                     |
Введите действительное число      |
>>> 10                            |
Ошибка: Показатель степени произведения больше допустимого по абсолютному значению
```
```
Введите целое число               |
>>> 0.1e1                         |
Введите действительное число      |
>>> 0.01e-99998                   |
Произведение этих чисел:
+0.1e-99999
```
```
Введите целое число               |
>>> 999999999999999999999999999999e99999
Введите действительное число      |
>>> 1e-30                         |
Произведение этих чисел:
+0.999999999999999999999999999999e+99999
```

## Вопросы
1. Каков возможный диапазон чисел, представляемых в ПК?

Зависит от того, сколько байт выделено под хранение этого числа, имеет ли
оно знак, в каком виде представлено (целое, действительное). Для 64-разрядного
процессора максимальный возможный диапазон целых чисел: -2^63..2^63-1 или 0..2^64-1,
действительные числа находятся в диапазоне от 3.6E-4951 до 1.1E+4932.

2. Какова возможная точность представления чисел, чем она определяется?

Числа с плавающей точкой хранятся в виде X = M * E^p, где M — мантисса
со знаком, E — основание (10 или 16), p — целый порядок со знаком.
Точность числа зависит от длины мантиссы, которая зависит от области
выделяемой памяти (которая зависит от разрядности системы). Максимально под
представление мантиссы отводится 52 бита, поэтому количество цифр в ней не может
превышать 16.

3. Какие стандартные операции возможны над числами?

Сложение, вычитание, умножение, деление, сравнение, битовые операции.

4. Какой тип данных может выбрать программист, если обрабатываемые числа
превышают возможный диапазон представления чисел в ПК?

Мантиссу можно хранить массивом (цифр, допустим), показатель степени в
целочисленной переменной, знак в переменной типа `bool`.

5. Как можно осуществить операции над числами, выходящими за рамки машинного
представления?

Операции над большими числами можно выполнять путём последовательного
выполнения операций над всеми цифрами, составляющих число.

## Вывод
В результате проделанной работы была реализована структура данных для хранения
длинных действительных чисел, парсер строки в длинное действительное число, а
также арифметическая операция умножения двух таких чисел.
